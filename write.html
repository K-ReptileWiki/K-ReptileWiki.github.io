<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“ ê¸€ì“°ê¸° - K-ReptileWiki</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    body { font-family: Arial, sans-serif; background:#f9fafb; padding:20px; }
    #editor { height:300px; background:#fff; }
    button { margin:5px; padding:8px 14px; border:none; border-radius:6px; cursor:pointer; }
    #previewArea { margin-top:20px; background:#fff; padding:15px; border-radius:8px; }
  </style>
</head>
<body>
  <h1>ğŸ“ ê¸€ì“°ê¸°</h1>

  <!-- ì œëª© ì…ë ¥ -->
  <input id="postTitle" placeholder="ì œëª©" style="width:100%;padding:8px;"><br>

  <!-- Quill ì—ë””í„° -->
  <div id="editor"></div><br>

  <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
  <input type="file" id="images" multiple accept="image/*"><br>

  <!-- ë²„íŠ¼ -->
  <button id="postBtn">ë“±ë¡</button>
  <button id="previewBtn">ë¯¸ë¦¬ë³´ê¸°</button>
  <button id="cancelBtn">ì·¨ì†Œ</button>

  <!-- ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
  <div id="previewArea" style="display:none;"></div>

  <!-- Quill ì—ë””í„° JS -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = "https://cpaikpjzlzzujwfgnanb.supabase.co";
    const supabaseKey = "sb_publishable_-dZ6xDssPQs29A_hHa2Irw_WxZ24NxB";
    const supabase = createClient(supabaseUrl, supabaseKey);

    // âœ… Quill ì—ë””í„° ì´ˆê¸°í™” (ë„¤ì´ë²„ ë¸”ë¡œê·¸ì²˜ëŸ¼ ì„œì‹ íˆ´ë°” í™•ì¥)
    const quill = new Quill('#editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline', 'strike'],   // êµµê²Œ, ê¸°ìš¸ì„, ë°‘ì¤„, ì·¨ì†Œì„ 
          [{ 'header': [1, 2, 3, false] }],            // ì œëª© í¬ê¸°
          [{ 'color': [] }, { 'background': [] }],     // ê¸€ììƒ‰, ë°°ê²½ìƒ‰
          [{ 'align': [] }],                           // ì •ë ¬
          ['blockquote', 'code-block'],                // ì¸ìš©êµ¬, ì½”ë“œ ë¸”ë¡
          ['link', 'image']                            // ë§í¬, ì´ë¯¸ì§€ ì‚½ì…
        ]
      },
      placeholder: "ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
    });

    // ê¸€ ë“±ë¡ ë²„íŠ¼ ì´ë²¤íŠ¸ (posts.js ë¡œì§ê³¼ ë™ì¼í•˜ê²Œ ì—°ê²° ê°€ëŠ¥)
    document.getElementById("postBtn").onclick = async () => {
      const title = document.getElementById("postTitle").value.trim();
      const content = quill.root.innerHTML;
      if (!title || !content) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”");

      // ë¡œê·¸ì¸ ì‚¬ìš©ì ê°€ì ¸ì˜¤ê¸°
      const { data: { user } } = await supabase.auth.getUser();

      const { data, error } = await supabase
        .from("wiki_posts")
        .insert([{
          title,
          content,
          author: user?.email ?? "ìµëª…",
          uid: user?.id ?? null,
          time: new Date().toISOString()
        }])
        .select();

      if (error) {
        alert("ê¸€ ë“±ë¡ ì‹¤íŒ¨: " + error.message);
      } else {
        alert("ê¸€ì´ ê²Œì‹œë˜ì—ˆìŠµë‹ˆë‹¤!");
        // ìƒˆ ê¸€ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
        if (data?.length) {
          location.href = `post.html?id=${data[0].id}`;
        } else {
          location.href = "index.html";
        }
      }
    };

    // ì·¨ì†Œ ë²„íŠ¼
    document.getElementById("cancelBtn").onclick = () => {
      if (confirm("ì‘ì„± ì¤‘ì¸ ê¸€ì„ ì·¨ì†Œí•˜ê³  ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        location.href = "index.html";
      }
    };

    // ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼
    document.getElementById("previewBtn").onclick = () => {
      const title = document.getElementById("postTitle").value.trim();
      const content = quill.root.innerHTML;
      const previewArea = document.getElementById("previewArea");
      previewArea.style.display = "block";
      previewArea.innerHTML = `
        <h3>${title || "(ì œëª© ì—†ìŒ)"}</h3>
        <div>${content || "(ë‚´ìš© ì—†ìŒ)"}</div>
      `;
    };
  </script>
</body>
</html>